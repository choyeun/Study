"use strict";var Te=Object.defineProperty;var xe=(i,t,e)=>t in i?Te(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var kt=(i,t,e)=>(xe(i,typeof t!="symbol"?t+"":t,e),e);const f=require("obsidian"),Le=require("@codemirror/view"),$e=require("@codemirror/state");function ut(i,t){const e=Object.keys(t).map(n=>Re(i,n,t[n]));return e.length===1?e[0]:function(){e.forEach(n=>n())}}function Re(i,t,e){const n=i[t],s=i.hasOwnProperty(t);let o=e(n);return n&&Object.setPrototypeOf(o,n),Object.setPrototypeOf(a,o),i[t]=a,r;function a(...d){return o===n&&i[t]===a&&r(),o.apply(this,d)}function r(){i[t]===a&&(s?i[t]=n:delete i[t]),o!==n&&(o=n,Object.setPrototypeOf(a,n||Function))}}function Gt(i){const t=[];for(let e=0;e<i;e++)t.push((16*Math.random()|0).toString(16));return t.join("")}const ft=new WeakMap;function yt(i){return i.containerEl.matches(".dn-editor.dn-leaf-view .workspace-leaf")}function Ne(i){const t=function(){return Object.setPrototypeOf(new f.Component,new.target.prototype)};return t.prototype=i.prototype,Object.setPrototypeOf(t,i)}const Pe=(i,t,e,n)=>{let s=i.app.workspace.activeLeaf;s||(s=e),t||(t=s==null?void 0:s.containerEl);const o=new et(s,t,i,void 0,n);return[o.attachLeaf(),o]};class et extends Ne(f.HoverPopover){constructor(t,e,n,s,o){var r,d;super(),this.targetEl=e,this.plugin=n,this.onShowCallback=o,this.abortController=this.addChild(new f.Component),this.detaching=!1,this.opening=!1,this.rootSplit=new f.WorkspaceSplit(window.app.workspace,"vertical"),this.isPinned=!0,this.oldPopover=(r=this.parent)==null?void 0:r.DailyNoteEditor,this.id=Gt(8),s===void 0&&(s=300),this.onTarget=!0,this.parent=t,this.waitTime=s,this.state=f.PopoverState.Showing,this.document=((d=this.targetEl)==null?void 0:d.ownerDocument)??window.activeDocument??window.document,this.hoverEl=this.document.defaultView.createDiv({cls:"dn-editor dn-leaf-view",attr:{id:"dn-"+this.id}});const{hoverEl:a}=this;this.abortController.load(),this.timer=window.setTimeout(this.show.bind(this),s),this.setActive=this._setActive.bind(this),a&&a.addEventListener("mousedown",this.setActive),ft.set(this.hoverEl,this),this.hoverEl.addClass("dn-editor"),this.containerEl=this.hoverEl.createDiv("dn-content"),this.buildWindowControls(),this.setInitialDimensions()}static activeWindows(){const t=[window],{floatingSplit:e}=app.workspace;if(e)for(const n of e.children)n.win&&t.push(n.win);return t}static containerForDocument(t,e){if(e!==document&&t.app.workspace.floatingSplit){for(const n of t.app.workspace.floatingSplit.children)if(n.doc===e)return n}return t.app.workspace.rootSplit}static activePopovers(){return this.activeWindows().flatMap(this.popoversForWindow)}static popoversForWindow(t){var e;return Array.prototype.slice.call(((e=t==null?void 0:t.document)==null?void 0:e.body.querySelectorAll(".dn-leaf-view"))??[]).map(n=>ft.get(n)).filter(n=>n)}static forLeaf(t){const e=t&&document.body.matchParent.call(t.containerEl,".dn-leaf-view");return e?ft.get(e):void 0}static iteratePopoverLeaves(t,e){for(const n of this.activePopovers())if(n.rootSplit&&t.iterateLeaves(e,n.rootSplit))return!0;return!1}_setActive(t){t.preventDefault(),t.stopPropagation(),this.plugin.app.workspace.setActiveLeaf(this.leaves()[0],{focus:!0})}getDefaultMode(){return"source"}updateLeaves(){this.onTarget&&this.targetEl&&!this.document.contains(this.targetEl)&&(this.onTarget=!1,this.transition());let t=0;this.plugin.app.workspace.iterateLeaves(e=>{t++},this.rootSplit),t===0&&this.hide(),this.hoverEl.setAttribute("data-leaf-count",t.toString())}leaves(){const t=[];return this.plugin.app.workspace.iterateLeaves(e=>{t.push(e)},this.rootSplit),t}setInitialDimensions(){this.hoverEl.style.height="auto",this.hoverEl.style.width="100%"}transition(){this.shouldShow()?this.state===f.PopoverState.Hiding&&(this.state=f.PopoverState.Shown,window.clearTimeout(this.timer)):this.state===f.PopoverState.Showing?this.hide():this.state===f.PopoverState.Shown&&(this.state=f.PopoverState.Hiding,this.timer=window.setTimeout(()=>{this.shouldShow()?this.transition():this.hide()},this.waitTime))}buildWindowControls(){this.titleEl=this.document.defaultView.createDiv("popover-titlebar"),this.titleEl.createDiv("popover-title"),this.containerEl.prepend(this.titleEl)}attachLeaf(){this.rootSplit.getRoot=()=>this.plugin.app.workspace[this.document===document?"rootSplit":"floatingSplit"],this.rootSplit.getContainer=()=>et.containerForDocument(this.plugin,this.document),this.titleEl.insertAdjacentElement("afterend",this.rootSplit.containerEl);const t=this.plugin.app.workspace.createLeafInParent(this.rootSplit,0);return this.updateLeaves(),t}onload(){super.onload(),this.registerEvent(this.plugin.app.workspace.on("layout-change",this.updateLeaves,this)),this.registerEvent(this.plugin.app.workspace.on("layout-change",()=>{this.rootSplit.children.forEach((t,e)=>{t instanceof f.WorkspaceTabs&&this.rootSplit.replaceChild(e,t.children[0])})}))}onShow(){var o,a;setTimeout(()=>this.waitTime=600,600),(o=this.oldPopover)==null||o.hide(),this.oldPopover=null,this.hoverEl.toggleClass("is-new",!0),this.document.body.addEventListener("click",()=>{this.hoverEl.toggleClass("is-new",!1)},{once:!0,capture:!0}),this.parent&&(this.parent.DailyNoteEditor=this);const e=this.hoverEl.querySelector(".view-header");e==null||e.remove();const n=this.hoverEl.querySelector(".workspace-leaf");n&&this.hoverEl.appendChild(n);const s=this.hoverEl.querySelector(".inline-title");s&&s.remove(),(a=this.onShowCallback)==null||a.call(this),this.onShowCallback=void 0}detect(t){const{targetEl:e}=this;e&&(this.onTarget=t===e||e.contains(t))}shouldShow(){return this.shouldShowSelf()||this.shouldShowChild()}shouldShowChild(){return et.activePopovers().some(t=>t!==this&&t.targetEl&&this.hoverEl.contains(t.targetEl)?t.shouldShow():!1)}shouldShowSelf(){return!this.detaching&&!!(this.onTarget||this.state==f.PopoverState.Shown||this.document.querySelector(`body>.modal-container, body > #he${this.id} ~ .menu, body > #he${this.id} ~ .suggestion-container`))}show(){!this.targetEl||this.document.body.contains(this.targetEl)?(this.state=f.PopoverState.Shown,this.timer=0,this.targetEl.appendChild(this.hoverEl),this.onShow(),this.plugin.app.workspace.onLayoutChange(),this.load()):this.hide(),this.hoverEl.dataset.imgHeight&&this.hoverEl.dataset.imgWidth&&(this.hoverEl.style.height=parseFloat(this.hoverEl.dataset.imgHeight)+this.titleEl.offsetHeight+"px",this.hoverEl.style.width=parseFloat(this.hoverEl.dataset.imgWidth)+"px")}onHide(){var t;this.oldPopover=null,((t=this.parent)==null?void 0:t.DailyNoteEditor)===this&&(this.parent.DailyNoteEditor=null)}hide(){var e;if(this.onTarget=!1,this.detaching=!0,this.timer&&(window.clearTimeout(this.timer),this.timer=0),this.hoverEl.hide(),this.opening)return;const t=this.leaves();if(t.length)t[0].detach();else return this.parent=null,(e=this.abortController)==null||e.unload(),this.abortController=void 0,this.nativeHide()}nativeHide(){var n;const{hoverEl:t,targetEl:e}=this;if(this.state=f.PopoverState.Hidden,t.detach(),e){const s=e.matchParent(".dn-leaf-view");s&&((n=ft.get(s))==null||n.transition())}this.onHide(),this.unload()}resolveLink(t,e){const n=f.parseLinktext(t);return n?this.plugin.app.metadataCache.getFirstLinkpathDest(n.path,e):null}async openLink(t,e,n,s){var g,p,w;let o=this.resolveLink(t,e);const a=f.parseLinktext(t);if(!o&&s){const y=this.plugin.app.fileManager.getNewFileParent(e);o=await this.plugin.app.fileManager.createNewMarkdownFile(y,a.path)}if(!o)return;const{viewRegistry:r}=this.plugin.app,d=r.typeByExtension[o.extension];if(!d||!r.viewByType[d])return;n=Object.assign(this.buildEphemeralState(o,a),n);const l=this.getDefaultMode(),h=this.buildState(l,n),c=await this.openFile(o,h,s),u=(g=c==null?void 0:c.view)==null?void 0:g.getViewType();if(u==="image"){(p=this.parent)!=null&&p.hasOwnProperty("editorEl")&&this.parent.editorEl.hasClass("is-live-preview")&&(this.waitTime=3e3);const y=c.view.contentEl.querySelector("img");this.hoverEl.dataset.imgHeight=String(y.naturalHeight),this.hoverEl.dataset.imgWidth=String(y.naturalWidth),this.hoverEl.dataset.imgRatio=String(y.naturalWidth/y.naturalHeight)}else u==="pdf"&&(this.hoverEl.style.height="800px",this.hoverEl.style.width="600px");((w=h.state)==null?void 0:w.mode)==="source"&&this.whenShown(()=>{var y,F,m,$;f.requireApiVersion("1.0")&&((m=(F=(y=c==null?void 0:c.view)==null?void 0:y.editMode)==null?void 0:F.reinit)==null||m.call(F)),($=c==null?void 0:c.view)==null||$.setEphemeralState(h.eState)})}whenShown(t){if(this.detaching)return;const e=this.onShowCallback;this.onShowCallback=()=>{this.detaching||(t(),typeof e=="function"&&e())},this.state===f.PopoverState.Shown&&(this.onShowCallback(),this.onShowCallback=void 0)}async openFile(t,e,n){if(this.detaching)return;const s=n??this.attachLeaf();this.opening=!0;try{await s.openFile(t,e)}catch(o){console.error(o)}finally{this.opening=!1,this.detaching&&this.hide()}return this.plugin.app.workspace.setActiveLeaf(s),s}buildState(t,e){return{active:!1,state:{mode:"source"},eState:e}}buildEphemeralState(t,e){const n=this.plugin.app.metadataCache.getFileCache(t),s=n?f.resolveSubpath(n,(e==null?void 0:e.subpath)||""):void 0,o={subpath:e==null?void 0:e.subpath};return s&&(o.line=s.start.line,o.startLoc=s.start,o.endLoc=s.end||void 0),o}}const _e=()=>{f.addIcon("daily-note",'<svg width="103" height="134" viewBox="0 0 103 134" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M60.3446 21.848H22.5577C19.5764 21.848 17.1595 24.2648 17.1595 27.2462V65.0331C17.1595 68.0144 19.5764 70.4312 22.5577 70.4312H60.3446C63.3259 70.4312 65.7428 68.0144 65.7428 65.0331V27.2462C65.7428 24.2648 63.3259 21.848 60.3446 21.848Z" stroke="#5C1111" stroke-width="4.81618" stroke-linecap="round" stroke-linejoin="round"/><path d="M52.2476 16.4498V27.2461" stroke="#5C1111" stroke-width="4.81618" stroke-linecap="round" stroke-linejoin="round"/><path d="M30.655 16.4498V27.2461" stroke="#5C1111" stroke-width="4.81618" stroke-linecap="round" stroke-linejoin="round"/><path d="M17.1595 38.0424H65.7428" stroke="#5C1111" stroke-width="4.81618" stroke-linecap="round" stroke-linejoin="round"/><path d="M33.3541 54.2366L38.7523 59.6348L49.5485 48.8385" stroke="#5C1111" stroke-width="4.81618" stroke-linecap="round" stroke-linejoin="round"/><g filter="url(#filter0_ddddd_104_2)"><path d="M12.181 103.617L9.21851 95.8213L27.9292 87.0896L66.754 71.4973L93.1049 88.8047L91.3898 103.617H12.181Z" fill="#AC4DD9" stroke="black" stroke-width="0.963236"/><path d="M12.181 103.617L9.21851 95.9771L27.9292 87.0895L32.6069 103.461L12.181 103.617Z" fill="#540D75" stroke="black" stroke-width="0.963236"/><path d="M9.0625 95.6652L25.7894 67.212L27.9291 87.0894L9.21842 95.977L9.0625 95.6652Z" fill="#470068" stroke="black" stroke-width="0.481618"/><path d="M27.9291 87.0896L25.9021 66.8197L67.5335 56.2169L66.5979 71.4973L27.9291 87.0896Z" fill="#732E94" stroke="black" stroke-width="0.963236"/><path d="M66.598 71.4971L67.9466 56.3527L93.1049 88.8045L66.598 71.4971Z" fill="#C279E4" stroke="black" stroke-width="0.481618"/><path d="M9.0625 95.6652L25.7462 66.8195L67.9465 56.0808L93.1049 88.8046L66.598 71.4972L27.9291 87.0895L9.21842 95.9771L9.0625 95.6652Z" stroke="black" stroke-width="0.963236"/><path d="M26.0579 103.617L27.9289 87.0895L32.7625 103.617H26.0579Z" fill="#61018E" stroke="black" stroke-width="0.963236"/></g><defs><filter id="filter0_ddddd_104_2" x="0.0874329" y="53.8502" width="101.958" height="79.8707" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix"/><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/><feOffset/><feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0"/><feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_104_2"/><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/><feOffset dy="1.20405"/><feGaussianBlur stdDeviation="1.44485"/><feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0"/><feBlend mode="normal" in2="effect1_dropShadow_104_2" result="effect2_dropShadow_104_2"/><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/><feOffset dy="5.2978"/><feGaussianBlur stdDeviation="2.6489"/><feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.09 0"/><feBlend mode="normal" in2="effect2_dropShadow_104_2" result="effect3_dropShadow_104_2"/><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/><feOffset dy="11.7996"/><feGaussianBlur stdDeviation="3.61213"/><feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.05 0"/><feBlend mode="normal" in2="effect3_dropShadow_104_2" result="effect4_dropShadow_104_2"/><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/><feOffset dy="21.1912"/><feGaussianBlur stdDeviation="4.21416"/><feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.01 0"/><feBlend mode="normal" in2="effect4_dropShadow_104_2" result="effect5_dropShadow_104_2"/><feBlend mode="normal" in="SourceGraphic" in2="effect5_dropShadow_104_2" result="shape"/></filter></defs></svg>')},Ae={hideFrontmatter:!1,hideBacklinks:!1,createAndOpenOnStartup:!1,preset:[]};class Oe extends f.PluginSettingTab{constructor(t,e){super(t,e),this.debounceApplySettingsUpdate=f.debounce(async()=>{await this.plugin.saveSettings()},200,!0),this.debounceDisplay=f.debounce(async()=>{await this.display()},400,!0),this.plugin=e}applySettingsUpdate(){this.debounceApplySettingsUpdate()}async display(){await this.plugin.loadSettings();const{containerEl:t}=this,e=this.plugin.settings;t.toggleClass("daily-note-settings-container",!0),t.empty(),new f.Setting(t).setName("Hide frontmatter").setDesc("Hide frontmatter in daily notes").addToggle(s=>s.setValue(e.hideFrontmatter).onChange(async o=>{this.plugin.settings.hideFrontmatter=o,document.body.classList.toggle("daily-notes-hide-frontmatter",o),this.applySettingsUpdate()})),new f.Setting(t).setName("Hide backlinks").setDesc("Hide backlinks in daily notes").addToggle(s=>s.setValue(e.hideBacklinks).onChange(async o=>{this.plugin.settings.hideBacklinks=o,document.body.classList.toggle("daily-notes-hide-backlinks",o),this.applySettingsUpdate()})),new f.Setting(t).setName("Create and open Daily Notes Editor on startup").setDesc("Automatically create today's daily note and open the Daily Notes Editor when Obsidian starts").addToggle(s=>s.setValue(e.createAndOpenOnStartup).onChange(async o=>{this.plugin.settings.createAndOpenOnStartup=o,this.applySettingsUpdate()})),new f.Setting(t).setName("Saved presets").setHeading();const n=t.createDiv("preset-container");e.preset.length===0?n.createEl("p",{text:"No presets saved yet. Select a folder or tag in the Daily Notes Editor to create a preset.",cls:"no-presets-message"}):e.preset.forEach((s,o)=>{new f.Setting(t).setName(s.type==="folder"?"Focus on Folder: ":"Focus on Tag: ").setDesc(s.target).addButton(a=>{a.setIcon("trash"),a.onClick(()=>{e.preset.splice(o,1),this.applySettingsUpdate(),this.debounceDisplay()})})}),new f.Setting(t).setName("Add new preset").setDesc("Add a new folder or tag preset").addButton(s=>{s.setButtonText("Add Preset").setCta().onClick(()=>{new Be(this.app,(a,r)=>{e.preset.findIndex(l=>l.type===a&&l.target===r)===-1&&(e.preset.push({type:a,target:r}),this.applySettingsUpdate(),this.debounceDisplay())}).open()})})}}class Be extends f.Modal{constructor(t,e){super(t),this.type="folder",this.saveCallback=e}onOpen(){const{contentEl:t}=this;t.empty(),t.createEl("h2",{text:"Add New Preset"});const e=t.createEl("form");e.addEventListener("submit",u=>{u.preventDefault(),this.save()});const n=e.createDiv();n.addClass("setting-item");const s=n.createDiv();s.addClass("setting-item-info"),s.createEl("div",{text:"Preset Type",cls:"setting-item-name"});const o=n.createDiv();o.addClass("setting-item-control");const a=o.createEl("input",{type:"radio",attr:{name:"preset-type",id:"preset-type-folder",value:"folder",checked:!0}});o.createEl("label",{text:"Folder",attr:{for:"preset-type-folder"}});const r=o.createEl("input",{type:"radio",attr:{name:"preset-type",id:"preset-type-tag",value:"tag"}});o.createEl("label",{text:"Tag",attr:{for:"preset-type-tag"}}),a.addEventListener("change",()=>{a.checked&&(this.type="folder")}),r.addEventListener("change",()=>{r.checked&&(this.type="tag")});const d=e.createDiv();d.addClass("setting-item");const l=d.createDiv();l.addClass("setting-item-info"),l.createEl("div",{text:"Target",cls:"setting-item-name"}),l.createEl("div",{text:"Enter the folder path or tag name",cls:"setting-item-description"});const h=d.createDiv();h.addClass("setting-item-control"),this.targetInput=h.createEl("input",{type:"text",value:"",placeholder:"Enter folder path or tag name"}),this.targetInput.addClass("target-input");const c=t.createDiv();c.addClass("modal-button-container"),c.createEl("button",{text:"Cancel",cls:"mod-warning",attr:{type:"button"}}).addEventListener("click",()=>{this.close()}),c.createEl("button",{text:"Save",cls:"mod-cta",attr:{type:"submit"}}).addEventListener("click",u=>{u.preventDefault(),this.save()})}save(){const t=this.targetInput.value.trim();t&&(this.saveCallback(this.type,t),this.close())}onClose(){const{contentEl:t}=this;t.empty()}}var S={};Object.defineProperty(S,"__esModule",{value:!0});var M=f;const Ct="YYYY-MM-DD",Dt="gggg-[W]ww",Kt="YYYY-MM",Jt="YYYY-[Q]Q",Xt="YYYY";function st(i){var e,n;const t=window.app.plugins.getPlugin("periodic-notes");return t&&((n=(e=t.settings)==null?void 0:e[i])==null?void 0:n.enabled)}function ot(){var i,t,e,n;try{const{internalPlugins:s,plugins:o}=window.app;if(st("daily")){const{format:l,folder:h,template:c}=((t=(i=o.getPlugin("periodic-notes"))==null?void 0:i.settings)==null?void 0:t.daily)||{};return{format:l||Ct,folder:(h==null?void 0:h.trim())||"",template:(c==null?void 0:c.trim())||""}}const{folder:a,format:r,template:d}=((n=(e=s.getPluginById("daily-notes"))==null?void 0:e.instance)==null?void 0:n.options)||{};return{format:r||Ct,folder:(a==null?void 0:a.trim())||"",template:(d==null?void 0:d.trim())||""}}catch{}}function at(){var i,t,e,n,s,o,a;try{const r=window.app.plugins,d=(i=r.getPlugin("calendar"))==null?void 0:i.options,l=(e=(t=r.getPlugin("periodic-notes"))==null?void 0:t.settings)==null?void 0:e.weekly;if(st("weekly"))return{format:l.format||Dt,folder:((n=l.folder)==null?void 0:n.trim())||"",template:((s=l.template)==null?void 0:s.trim())||""};const h=d||{};return{format:h.weeklyNoteFormat||Dt,folder:((o=h.weeklyNoteFolder)==null?void 0:o.trim())||"",template:((a=h.weeklyNoteTemplate)==null?void 0:a.trim())||""}}catch{}}function rt(){var t,e,n,s;const i=window.app.plugins;try{const o=st("monthly")&&((e=(t=i.getPlugin("periodic-notes"))==null?void 0:t.settings)==null?void 0:e.monthly)||{};return{format:o.format||Kt,folder:((n=o.folder)==null?void 0:n.trim())||"",template:((s=o.template)==null?void 0:s.trim())||""}}catch{}}function lt(){var t,e,n,s;const i=window.app.plugins;try{const o=st("quarterly")&&((e=(t=i.getPlugin("periodic-notes"))==null?void 0:t.settings)==null?void 0:e.quarterly)||{};return{format:o.format||Jt,folder:((n=o.folder)==null?void 0:n.trim())||"",template:((s=o.template)==null?void 0:s.trim())||""}}catch{}}function ct(){var t,e,n,s;const i=window.app.plugins;try{const o=st("yearly")&&((e=(t=i.getPlugin("periodic-notes"))==null?void 0:t.settings)==null?void 0:e.yearly)||{};return{format:o.format||Xt,folder:((n=o.folder)==null?void 0:n.trim())||"",template:((s=o.template)==null?void 0:s.trim())||""}}catch{}}function te(...i){let t=[];for(let n=0,s=i.length;n<s;n++)t=t.concat(i[n].split("/"));const e=[];for(let n=0,s=t.length;n<s;n++){const o=t[n];!o||o==="."||e.push(o)}return t[0]===""&&e.unshift(""),e.join("/")}function Ie(i){let t=i.substring(i.lastIndexOf("/")+1);return t.lastIndexOf(".")!=-1&&(t=t.substring(0,t.lastIndexOf("."))),t}async function He(i){const t=i.replace(/\\/g,"/").split("/");if(t.pop(),t.length){const e=te(...t);window.app.vault.getAbstractFileByPath(e)||await window.app.vault.createFolder(e)}}async function dt(i,t){t.endsWith(".md")||(t+=".md");const e=M.normalizePath(te(i,t));return await He(e),e}async function Q(i){const{metadataCache:t,vault:e}=window.app,n=M.normalizePath(i);if(n==="/")return Promise.resolve(["",null]);try{const s=t.getFirstLinkpathDest(n,""),o=await e.cachedRead(s),a=window.app.foldManager.load(s);return[o,a]}catch(s){return console.error(`Failed to read the daily note template '${n}'`,s),new M.Notice("Failed to read the daily note template"),["",null]}}function _(i,t="day"){const e=i.clone().startOf(t).format();return`${t}-${e}`}function ee(i){return i.replace(/\[[^\]]*\]/g,"")}function qe(i,t){if(t==="week"){const e=ee(i);return/w{1,2}/i.test(e)&&(/M{1,4}/.test(e)||/D{1,4}/.test(e))}return!1}function Z(i,t){return ie(i.basename,t)}function We(i,t){return ie(Ie(i),t)}function ie(i,t){const n={day:ot,week:at,month:rt,quarter:lt,year:ct}[t]().format.split("/").pop(),s=window.moment(i,n,!0);if(!s.isValid())return null;if(qe(n,t)&&t==="week"){const o=ee(n);if(/w{1,2}/i.test(o))return window.moment(i,n.replace(/M{1,4}/g,"").replace(/D{1,4}/g,""),!1)}return s}class Ye extends Error{}async function ne(i){const t=window.app,{vault:e}=t,n=window.moment,{template:s,format:o,folder:a}=ot(),[r,d]=await Q(s),l=i.format(o),h=await dt(a,l);try{const c=await e.create(h,r.replace(/{{\s*date\s*}}/gi,l).replace(/{{\s*time\s*}}/gi,n().format("HH:mm")).replace(/{{\s*title\s*}}/gi,l).replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(u,g,p,w,y,F)=>{const m=n(),$=i.clone().set({hour:m.get("hour"),minute:m.get("minute"),second:m.get("second")});return p&&$.add(parseInt(w,10),y),F?$.format(F.substring(1).trim()):$.format(o)}).replace(/{{\s*yesterday\s*}}/gi,i.clone().subtract(1,"day").format(o)).replace(/{{\s*tomorrow\s*}}/gi,i.clone().add(1,"d").format(o)));return t.foldManager.save(c,d),c}catch(c){console.error(`Failed to create file: '${h}'`,c),new M.Notice("Unable to create new file.")}}function Ve(i,t){return t[_(i,"day")]??null}function je(){const{vault:i}=window.app,{folder:t}=ot(),e=i.getAbstractFileByPath(M.normalizePath(t));if(!e)throw new Ye("Failed to find daily notes folder");const n={};return M.Vault.recurseChildren(e,s=>{if(s instanceof M.TFile){const o=Z(s,"day");if(o){const a=_(o,"day");n[a]=s}}}),n}class Ue extends Error{}function ze(){const{moment:i}=window;let t=i.localeData()._week.dow;const e=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];for(;t;)e.push(e.shift()),t--;return e}function Qe(i){return ze().indexOf(i.toLowerCase())}async function se(i){const{vault:t}=window.app,{template:e,format:n,folder:s}=at(),[o,a]=await Q(e),r=i.format(n),d=await dt(s,r);try{const l=await t.create(d,o.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(h,c,u,g,p,w)=>{const y=window.moment(),F=i.clone().set({hour:y.get("hour"),minute:y.get("minute"),second:y.get("second")});return u&&F.add(parseInt(g,10),p),w?F.format(w.substring(1).trim()):F.format(n)}).replace(/{{\s*title\s*}}/gi,r).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*(sunday|monday|tuesday|wednesday|thursday|friday|saturday)\s*:(.*?)}}/gi,(h,c,u)=>{const g=Qe(c);return i.weekday(g).format(u.trim())}));return window.app.foldManager.save(l,a),l}catch(l){console.error(`Failed to create file: '${d}'`,l),new M.Notice("Unable to create new file.")}}function Ze(i,t){return t[_(i,"week")]??null}function Ge(){const i={};if(!ae())return i;const{vault:t}=window.app,{folder:e}=at(),n=t.getAbstractFileByPath(M.normalizePath(e));if(!n)throw new Ue("Failed to find weekly notes folder");return M.Vault.recurseChildren(n,s=>{if(s instanceof M.TFile){const o=Z(s,"week");if(o){const a=_(o,"week");i[a]=s}}}),i}class Ke extends Error{}async function oe(i){const{vault:t}=window.app,{template:e,format:n,folder:s}=rt(),[o,a]=await Q(e),r=i.format(n),d=await dt(s,r);try{const l=await t.create(d,o.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(h,c,u,g,p,w)=>{const y=window.moment(),F=i.clone().set({hour:y.get("hour"),minute:y.get("minute"),second:y.get("second")});return u&&F.add(parseInt(g,10),p),w?F.format(w.substring(1).trim()):F.format(n)}).replace(/{{\s*date\s*}}/gi,r).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,r));return window.app.foldManager.save(l,a),l}catch(l){console.error(`Failed to create file: '${d}'`,l),new M.Notice("Unable to create new file.")}}function Je(i,t){return t[_(i,"month")]??null}function Xe(){const i={};if(!re())return i;const{vault:t}=window.app,{folder:e}=rt(),n=t.getAbstractFileByPath(M.normalizePath(e));if(!n)throw new Ke("Failed to find monthly notes folder");return M.Vault.recurseChildren(n,s=>{if(s instanceof M.TFile){const o=Z(s,"month");if(o){const a=_(o,"month");i[a]=s}}}),i}class ti extends Error{}async function ei(i){const{vault:t}=window.app,{template:e,format:n,folder:s}=lt(),[o,a]=await Q(e),r=i.format(n),d=await dt(s,r);try{const l=await t.create(d,o.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(h,c,u,g,p,w)=>{const y=window.moment(),F=i.clone().set({hour:y.get("hour"),minute:y.get("minute"),second:y.get("second")});return u&&F.add(parseInt(g,10),p),w?F.format(w.substring(1).trim()):F.format(n)}).replace(/{{\s*date\s*}}/gi,r).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,r));return window.app.foldManager.save(l,a),l}catch(l){console.error(`Failed to create file: '${d}'`,l),new M.Notice("Unable to create new file.")}}function ii(i,t){return t[_(i,"quarter")]??null}function ni(){const i={};if(!le())return i;const{vault:t}=window.app,{folder:e}=lt(),n=t.getAbstractFileByPath(M.normalizePath(e));if(!n)throw new ti("Failed to find quarterly notes folder");return M.Vault.recurseChildren(n,s=>{if(s instanceof M.TFile){const o=Z(s,"quarter");if(o){const a=_(o,"quarter");i[a]=s}}}),i}class si extends Error{}async function oi(i){const{vault:t}=window.app,{template:e,format:n,folder:s}=ct(),[o,a]=await Q(e),r=i.format(n),d=await dt(s,r);try{const l=await t.create(d,o.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(h,c,u,g,p,w)=>{const y=window.moment(),F=i.clone().set({hour:y.get("hour"),minute:y.get("minute"),second:y.get("second")});return u&&F.add(parseInt(g,10),p),w?F.format(w.substring(1).trim()):F.format(n)}).replace(/{{\s*date\s*}}/gi,r).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,r));return window.app.foldManager.save(l,a),l}catch(l){console.error(`Failed to create file: '${d}'`,l),new M.Notice("Unable to create new file.")}}function ai(i,t){return t[_(i,"year")]??null}function ri(){const i={};if(!ce())return i;const{vault:t}=window.app,{folder:e}=ct(),n=t.getAbstractFileByPath(M.normalizePath(e));if(!n)throw new si("Failed to find yearly notes folder");return M.Vault.recurseChildren(n,s=>{if(s instanceof M.TFile){const o=Z(s,"year");if(o){const a=_(o,"year");i[a]=s}}}),i}function li(){var n,s;const{app:i}=window,t=i.internalPlugins.plugins["daily-notes"];if(t&&t.enabled)return!0;const e=i.plugins.getPlugin("periodic-notes");return e&&((s=(n=e.settings)==null?void 0:n.daily)==null?void 0:s.enabled)}function ae(){var e,n;const{app:i}=window;if(i.plugins.getPlugin("calendar"))return!0;const t=i.plugins.getPlugin("periodic-notes");return t&&((n=(e=t.settings)==null?void 0:e.weekly)==null?void 0:n.enabled)}function re(){var e,n;const{app:i}=window,t=i.plugins.getPlugin("periodic-notes");return t&&((n=(e=t.settings)==null?void 0:e.monthly)==null?void 0:n.enabled)}function le(){var e,n;const{app:i}=window,t=i.plugins.getPlugin("periodic-notes");return t&&((n=(e=t.settings)==null?void 0:e.quarterly)==null?void 0:n.enabled)}function ce(){var e,n;const{app:i}=window,t=i.plugins.getPlugin("periodic-notes");return t&&((n=(e=t.settings)==null?void 0:e.yearly)==null?void 0:n.enabled)}function ci(i){const t={day:ot,week:at,month:rt,quarter:lt,year:ct}[i];return t()}function di(i,t){return{day:ne,month:oe,week:se}[i](t)}var Ft=S.DEFAULT_DAILY_NOTE_FORMAT=Ct;S.DEFAULT_MONTHLY_NOTE_FORMAT=Kt;S.DEFAULT_QUARTERLY_NOTE_FORMAT=Jt;S.DEFAULT_WEEKLY_NOTE_FORMAT=Dt;S.DEFAULT_YEARLY_NOTE_FORMAT=Xt;S.appHasDailyNotesPluginLoaded=li;S.appHasMonthlyNotesPluginLoaded=re;S.appHasQuarterlyNotesPluginLoaded=le;S.appHasWeeklyNotesPluginLoaded=ae;S.appHasYearlyNotesPluginLoaded=ce;var de=S.createDailyNote=ne;S.createMonthlyNote=oe;S.createPeriodicNote=di;S.createQuarterlyNote=ei;S.createWeeklyNote=se;S.createYearlyNote=oi;var he=S.getAllDailyNotes=je;S.getAllMonthlyNotes=Xe;S.getAllQuarterlyNotes=ni;S.getAllWeeklyNotes=Ge;S.getAllYearlyNotes=ri;var ue=S.getDailyNote=Ve,bt=S.getDailyNoteSettings=ot,Rt=S.getDateFromFile=Z;S.getDateFromPath=We;S.getDateUID=_;S.getMonthlyNote=Je;S.getMonthlyNoteSettings=rt;S.getPeriodicNoteSettings=ci;S.getQuarterlyNote=ii;S.getQuarterlyNoteSettings=lt;S.getTemplateInfo=Q;S.getWeeklyNote=Ze;S.getWeeklyNoteSettings=at;S.getYearlyNote=ai;S.getYearlyNoteSettings=ct;function hi(i){if(!i)return null;const t=i.view;return t instanceof f.MarkdownView?t.editor:null}function ui(i,t,e){if(!t||!yt(t))return null;const n=[];i.workspace.iterateAllLeaves(a=>{yt(a)&&n.push(a)}),n.sort((a,r)=>{const d=a.containerEl.getBoundingClientRect(),l=r.containerEl.getBoundingClientRect();return d.top-l.top});const s=n.findIndex(a=>a===t);if(s===-1)return null;const o=e==="up"?s-1:s+1;return o>=0&&o<n.length?n[o]:null}function Nt(i,t,e){const n=ui(i,t,e);if(!n)return!1;i.workspace.setActiveLeaf(n,{focus:!0});const s=hi(n);if(!s)return!1;let o;if(e==="up"){const a=s.lastLine(),r=s.getLine(a).length;o={line:a,ch:r}}else o={line:0,ch:0};return s.setCursor(o),s.scrollIntoView({from:o,to:o},!0),setTimeout(()=>{n.view instanceof f.MarkdownView&&(n.view.editMode&&n.view.editMode.editor?n.view.editMode.editor.focus():s.focus())},10),!0}function fi(i){var t;return((t=i.settings)==null?void 0:t.hideFrontmatter)===!0}function pi(i,t,e,n){var d,l;if(!fi(n)){const h=i.state.selection.main.head,c=i.state.doc.lineAt(h);return c.number===1&&h===c.from}const s=i.state.selection.main.head,o=i.state.doc.lineAt(s),a=e.metadataCache.getFileCache(t);if(!a||!a.frontmatter)return o.number===1&&s===o.from;const r=(((l=(d=a.frontmatterPosition)==null?void 0:d.end)==null?void 0:l.line)??0)+2;return o.number===r&&s===o.from}function gi(i){const{app:t,plugin:e}=i,n=[{key:"ArrowUp",run:s=>{var l;const o=s.state.selection.main.head;s.state.doc.lineAt(o);const a=s.state.field(f.editorInfoField),r=a==null?void 0:a.leaf,d=(l=r==null?void 0:r.view)==null?void 0:l.file;return!!(d&&pi(s,d,t,e)&&r&&Nt(t,r,"up"))}},{key:"ArrowDown",run:s=>{const o=s.state.selection.main.head,a=s.state.doc.lineAt(o),r=s.state.field(f.editorInfoField),d=r==null?void 0:r.leaf,l=s.state.doc.lines;return!!(a.number===l&&o===a.to&&d&&Nt(t,d,"down"))}}];return $e.Prec.highest(Le.keymap.of(n))}function V(){}function fe(i){return i()}function Pt(){return Object.create(null)}function O(i){i.forEach(fe)}function ht(i){return typeof i=="function"}function pe(i,t){return i!=i?t==t:i!==t||i&&typeof i=="object"||typeof i=="function"}function mi(i){return Object.keys(i).length===0}function ge(i){return i&&ht(i.destroy)?i.destroy:V}function R(i,t){i.appendChild(t)}function B(i,t,e){i.insertBefore(t,e||null)}function A(i){i.parentNode&&i.parentNode.removeChild(i)}function P(i){return document.createElement(i)}function _t(i){return document.createElementNS("http://www.w3.org/2000/svg",i)}function me(i){return document.createTextNode(i)}function W(){return me(" ")}function H(i,t,e,n){return i.addEventListener(t,e,n),()=>i.removeEventListener(t,e,n)}function k(i,t,e){e==null?i.removeAttribute(t):i.getAttribute(t)!==e&&i.setAttribute(t,e)}function wi(i){return Array.from(i.childNodes)}function yi(i,t){t=""+t,i.data!==t&&(i.data=t)}function At(i,t,e,n){e==null?i.style.removeProperty(t):i.style.setProperty(t,e,"")}let it;function tt(i){it=i}function we(){if(!it)throw new Error("Function called outside component initialization");return it}function ye(i){we().$$.on_mount.push(i)}function vi(i){we().$$.on_destroy.push(i)}const U=[],nt=[];let z=[];const Ot=[],ki=Promise.resolve();let Mt=!1;function Fi(){Mt||(Mt=!0,ki.then(ve))}function Tt(i){z.push(i)}const Et=new Set;let j=0;function ve(){if(j!==0)return;const i=it;do{try{for(;j<U.length;){const t=U[j];j++,tt(t),bi(t.$$)}}catch(t){throw U.length=0,j=0,t}for(tt(null),U.length=0,j=0;nt.length;)nt.pop()();for(let t=0;t<z.length;t+=1){const e=z[t];Et.has(e)||(Et.add(e),e())}z.length=0}while(U.length);for(;Ot.length;)Ot.pop()();Mt=!1,Et.clear(),tt(i)}function bi(i){if(i.fragment!==null){i.update(),O(i.before_update);const t=i.dirty;i.dirty=[-1],i.fragment&&i.fragment.p(i.ctx,t),i.after_update.forEach(Tt)}}function Ei(i){const t=[],e=[];z.forEach(n=>i.indexOf(n)===-1?t.push(n):e.push(n)),e.forEach(n=>n()),z=t}const mt=new Set;let Y;function Si(){Y={r:0,c:[],p:Y}}function Ci(){Y.r||O(Y.c),Y=Y.p}function vt(i,t){i&&i.i&&(mt.delete(i),i.i(t))}function Lt(i,t,e,n){if(i&&i.o){if(mt.has(i))return;mt.add(i),Y.c.push(()=>{mt.delete(i),n&&(e&&i.d(1),n())}),i.o(t)}else n&&n()}function Bt(i){return(i==null?void 0:i.length)!==void 0?i:Array.from(i)}function Di(i,t){Lt(i,1,1,()=>{t.delete(i.key)})}function Mi(i,t,e,n,s,o,a,r,d,l,h,c){let u=i.length,g=o.length,p=u;const w={};for(;p--;)w[i[p].key]=p;const y=[],F=new Map,m=new Map,$=[];for(p=g;p--;){const D=c(s,o,p),E=e(D);let x=a.get(E);x?$.push(()=>x.p(D,t)):(x=l(E,D),x.c()),F.set(E,y[p]=x),E in w&&m.set(E,Math.abs(p-w[E]))}const b=new Set,C=new Set;function T(D){vt(D,1),D.m(r,h),a.set(D.key,D),h=D.first,g--}for(;u&&g;){const D=y[g-1],E=i[u-1],x=D.key,N=E.key;D===E?(h=D.first,u--,g--):F.has(N)?!a.has(x)||b.has(x)?T(D):C.has(N)?u--:m.get(x)>m.get(N)?(C.add(x),T(D)):(b.add(N),u--):(d(E,a),u--)}for(;u--;){const D=i[u];F.has(D.key)||d(D,a)}for(;g;)T(y[g-1]);return O($),y}function Ti(i){i&&i.c()}function ke(i,t,e){const{fragment:n,after_update:s}=i.$$;n&&n.m(t,e),Tt(()=>{const o=i.$$.on_mount.map(fe).filter(ht);i.$$.on_destroy?i.$$.on_destroy.push(...o):O(o),i.$$.on_mount=[]}),s.forEach(Tt)}function Fe(i,t){const e=i.$$;e.fragment!==null&&(Ei(e.after_update),O(e.on_destroy),e.fragment&&e.fragment.d(t),e.on_destroy=e.fragment=null,e.ctx=[])}function xi(i,t){i.$$.dirty[0]===-1&&(U.push(i),Fi(),i.$$.dirty.fill(0)),i.$$.dirty[t/31|0]|=1<<t%31}function be(i,t,e,n,s,o,a=null,r=[-1]){const d=it;tt(i);const l=i.$$={fragment:null,ctx:[],props:o,update:V,not_equal:s,bound:Pt(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(d?d.$$.context:[])),callbacks:Pt(),dirty:r,skip_bound:!1,root:t.target||d.$$.root};a&&a(l.root);let h=!1;if(l.ctx=e?e(i,t.props||{},(c,u,...g)=>{const p=g.length?g[0]:u;return l.ctx&&s(l.ctx[c],l.ctx[c]=p)&&(!l.skip_bound&&l.bound[c]&&l.bound[c](p),h&&xi(i,c)),u}):[],l.update(),h=!0,O(l.before_update),l.fragment=n?n(l.ctx):!1,t.target){if(t.hydrate){const c=wi(t.target);l.fragment&&l.fragment.l(c),c.forEach(A)}else l.fragment&&l.fragment.c();t.intro&&vt(i.$$.fragment),ke(i,t.target,t.anchor),ve()}tt(d)}class Ee{constructor(){kt(this,"$$");kt(this,"$$set")}$destroy(){Fe(this,1),this.$destroy=V}$on(t,e){if(!ht(e))return V;const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const s=n.indexOf(e);s!==-1&&n.splice(s,1)}}$set(t){this.$$set&&!mi(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const Li="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Li);function $i(i,t,e,n){function s(o){return o instanceof e?o:new e(function(a){a(o)})}return new(e||(e=Promise))(function(o,a){function r(h){try{l(n.next(h))}catch(c){a(c)}}function d(h){try{l(n.throw(h))}catch(c){a(c)}}function l(h){h.done?o(h.value):s(h.value).then(r,d)}l((n=n.apply(i,[])).next())})}function It(i){let t,e,n,s,o,a,r,d,l,h;return{c(){t=P("div"),e=P("span"),n=_t("svg"),s=_t("path"),a=W(),r=P("span"),d=me(i[5]),k(s,"d","m6 9 6 6 6-6"),k(n,"xmlns","http://www.w3.org/2000/svg"),k(n,"width","24"),k(n,"height","24"),k(n,"viewBox","0 0 24 24"),k(n,"fill","none"),k(n,"stroke","currentColor"),k(n,"stroke-width","2"),k(n,"stroke-linecap","round"),k(n,"stroke-linejoin","round"),k(n,"class","lucide lucide-chevron-down"),k(e,"role","button"),k(e,"data-collapsed",i[7]),k(e,"class","collapse-button svelte-1d2sruf"),k(e,"title",o=i[7]?"Expand":"Collapse"),k(r,"role","link"),k(r,"class","clickable-link svelte-1d2sruf"),k(r,"data-title",i[5]),k(t,"class","daily-note-title inline-title svelte-1d2sruf")},m(c,u){B(c,t,u),R(t,e),R(e,n),R(n,s),R(t,a),R(t,r),R(r,d),l||(h=[H(e,"click",i[10]),H(r,"click",i[8])],l=!0)},p(c,u){u&128&&k(e,"data-collapsed",c[7]),u&128&&o!==(o=c[7]?"Expand":"Collapse")&&k(e,"title",o),u&32&&yi(d,c[5]),u&32&&k(r,"data-title",c[5])},d(c){c&&A(t),l=!1,O(h)}}}function Ht(i){let t;return{c(){t=P("div"),t.textContent="Loading...",k(t,"class","editor-placeholder svelte-1d2sruf")},m(e,n){B(e,t,n)},d(e){e&&A(t)}}}function qt(i){let t;return{c(){t=P("div"),t.textContent="Scroll to view content",k(t,"class","editor-placeholder svelte-1d2sruf")},m(e,n){B(e,t,n)},d(e){e&&A(t)}}}function Ri(i){let t,e,n,s,o,a,r,d,l=i[5]&&It(i),h=!i[3]&&i[1]&&Ht(),c=!i[1]&&!i[3]&&qt();return{c(){t=P("div"),e=P("div"),l&&l.c(),n=W(),s=P("div"),h&&h.c(),o=W(),c&&c.c(),k(s,"class","daily-note-editor svelte-1d2sruf"),k(s,"data-collapsed",i[7]),k(s,"aria-hidden","true"),k(s,"data-title",i[5]),k(e,"class","daily-note svelte-1d2sruf"),k(t,"class","daily-note-container"),k(t,"data-id",a="dn-editor-"+i[0].path),At(t,"min-height",i[7]?"auto":i[6]+"px")},m(u,g){B(u,t,g),R(t,e),l&&l.m(e,null),R(e,n),R(e,s),h&&h.m(s,null),R(s,o),c&&c.m(s,null),i[13](s),i[14](t),r||(d=H(s,"click",i[9]),r=!0)},p(u,[g]){u[5]?l?l.p(u,g):(l=It(u),l.c(),l.m(e,n)):l&&(l.d(1),l=null),!u[3]&&u[1]?h||(h=Ht(),h.c(),h.m(s,o)):h&&(h.d(1),h=null),!u[1]&&!u[3]?c||(c=qt(),c.c(),c.m(s,null)):c&&(c.d(1),c=null),g&128&&k(s,"data-collapsed",u[7]),g&32&&k(s,"data-title",u[5]),g&1&&a!==(a="dn-editor-"+u[0].path)&&k(t,"data-id",a),g&192&&At(t,"min-height",u[7]?"auto":u[6]+"px")},i:V,o:V,d(u){u&&A(t),l&&l.d(),h&&h.d(),c&&c.d(),i[13](null),i[14](null),r=!1,d()}}}function Ni(i,t,e){let{file:n}=t,{plugin:s}=t,{leaf:o}=t,{shouldRender:a=!0}=t,r,d,l,h=!1;Gt(8);let c,u=null,g=100,p=!1,w=!1;ye(()=>{n instanceof f.TFile&&e(5,l=n.basename)}),vi(()=>{p=!0,u&&window.clearTimeout(u),h&&c&&m()});function y(){if(n instanceof f.TFile&&!h&&!p){u&&(window.clearTimeout(u),u=null);try{const E=n instanceof f.TFile?n.basename:"unknown";[c]=Pe(s,r,o),c.setPinned(!0),c.setViewState({type:"markdown",state:{file:n.path,mode:"source",source:!1,backlinks:!s.settings.hideBacklinks,backlinkOpts:{collapseAll:!1,extraContext:!1,sortOrder:"alphabetical",showSearch:!1,searchQuery:"",backlinkCollapsed:!1,unlinkedCollapsed:!0}}}),c.parentLeaf=o,e(3,h=!0);const x=window.setTimeout(()=>{var N,G,K;if(c&&d){if(!(c.view instanceof f.MarkdownView))return;const J=(K=(G=(N=c.view.editMode)===null||N===void 0?void 0:N.editor)===null||G===void 0?void 0:G.cm)===null||K===void 0?void 0:K.dom.innerHeight;J>0&&(e(6,g=J),e(4,d.style.minHeight=`${g}px`,d),window.clearTimeout(x))}},400)}catch(E){console.error("Error creating leaf view:",E)}}}function F(){u&&window.clearTimeout(u),u=window.setTimeout(()=>{!a&&h&&m()},1e3)}function m(){if(!(!h||!c))try{const E=n instanceof f.TFile?n.basename:"unknown";c.detach&&c.detach(),r&&r.empty(),e(3,h=!1)}catch(E){console.error("Error unloading editor:",E)}}function $(){n instanceof f.TFile&&(o?o.openFile(n):s.app.workspace.getLeaf(!1).openFile(n))}function b(){var E,x;const N=(x=(E=c==null?void 0:c.view)===null||E===void 0?void 0:E.editMode)===null||x===void 0?void 0:x.editor;N&&!N.hasFocus()&&N.focus()}function C(){e(7,w=!w)}function T(E){nt[E?"unshift":"push"](()=>{r=E,e(2,r)})}function D(E){nt[E?"unshift":"push"](()=>{d=E,e(4,d)})}return i.$$set=E=>{"file"in E&&e(0,n=E.file),"plugin"in E&&e(11,s=E.plugin),"leaf"in E&&e(12,o=E.leaf),"shouldRender"in E&&e(1,a=E.shouldRender)},i.$$.update=()=>{i.$$.dirty&14&&(r&&a&&!h?y():r&&!a&&h&&F())},[n,a,r,h,d,l,g,w,$,b,C,s,o,T,D]}class Pi extends Ee{constructor(t){super(),be(this,t,Ni,Ri,pe,{file:0,plugin:11,leaf:12,shouldRender:1})}}function _i(i){return i()}function Ai(i){i.forEach(_i)}const pt=[],Wt=[],wt=[],Yt=[],Se=Promise.resolve();let xt=!1;function Oi(){xt||(xt=!0,Se.then(Hi))}function Bi(){return Oi(),Se}function Ii(i){wt.push(i)}const St=new Set;let gt=0;function Hi(){do{for(;gt<pt.length;){const i=pt[gt];gt++,qi(i.$$)}for(pt.length=0,gt=0;Wt.length;)Wt.pop()();for(let i=0;i<wt.length;i+=1){const t=wt[i];St.has(t)||(St.add(t),t())}wt.length=0}while(pt.length);for(;Yt.length;)Yt.pop()();xt=!1,St.clear()}function qi(i){if(i.fragment!==null){i.update(),Ai(i.before_update);const t=i.dirty;i.dirty=[-1],i.fragment&&i.fragment.p(i.ctx,t),i.after_update.forEach(Ii)}}const Wi={root:null,rootMargin:"0px",threshold:0,unobserveOnEnter:!1},I=(i,t)=>new CustomEvent(i,{detail:t});function Ce(i,t={}){const{root:e,rootMargin:n,threshold:s,unobserveOnEnter:o}=Object.assign(Object.assign({},Wi),t);let a={x:void 0,y:void 0},r={vertical:void 0,horizontal:void 0};if(typeof IntersectionObserver<"u"&&i){const d=new IntersectionObserver((l,h)=>{l.forEach(c=>{a.y>c.boundingClientRect.y?r.vertical="up":r.vertical="down",a.x>c.boundingClientRect.x?r.horizontal="left":r.horizontal="right",a={y:c.boundingClientRect.y,x:c.boundingClientRect.x};const u={inView:c.isIntersecting,entry:c,scrollDirection:r,node:i,observer:h};i.dispatchEvent(I("inview_change",u)),i.dispatchEvent(I("change",u)),c.isIntersecting?(i.dispatchEvent(I("inview_enter",u)),i.dispatchEvent(I("enter",u)),o&&h.unobserve(i)):(i.dispatchEvent(I("inview_leave",u)),i.dispatchEvent(I("leave",u)))})},{root:e,rootMargin:n,threshold:s});return Bi().then(()=>{i.dispatchEvent(I("inview_init",{observer:d,node:i})),i.dispatchEvent(I("init",{observer:d,node:i}))}),d.observe(i),{destroy(){d.unobserve(i)}}}}class Yi{constructor(t){this.allFiles=[],this.filteredFiles=[],this.hasFetched=!1,this.hasCurrentDay=!0,this.cacheDailyNotes={},this.options=t,this.fetchFiles()}parseTimeField(t){const e=t||"mtime",n=e.endsWith("Reverse"),s=n?e.replace("Reverse",""):e;return{isReverse:n,baseTimeField:s}}sortFilesByTimeField(t,e){const{isReverse:n,baseTimeField:s}=this.parseTimeField(e);return[...t].sort((o,a)=>n?o.stat[s]-a.stat[s]:a.stat[s]-o.stat[s])}fetchFiles(){if(!this.hasFetched){switch(this.options.mode){case"daily":this.fetchDailyNotes();break;case"folder":this.fetchFolderFiles();break;case"tag":this.fetchTaggedFiles();break}this.hasFetched=!0,this.checkDailyNote(),this.filterFilesByRange()}}fetchDailyNotes(){this.cacheDailyNotes=he();for(const t of Object.keys(this.cacheDailyNotes).sort().reverse())this.allFiles.push(this.cacheDailyNotes[t])}fetchFolderFiles(){if(!this.options.target||!this.options.app)return;const t=this.options.app.vault.getMarkdownFiles();this.allFiles=t.filter(e=>{var s;const n=((s=e.parent)==null?void 0:s.path)||"";return n===this.options.target||n.startsWith(this.options.target+"/")}),this.allFiles=this.sortFilesByTimeField(this.allFiles,this.options.timeField)}fetchTaggedFiles(){if(!this.options.target||!this.options.app)return;const t=this.options.app.vault.getMarkdownFiles(),e=this.options.target.startsWith("#")?this.options.target:"#"+this.options.target;this.allFiles=t.filter(n=>{var o;const s=(o=this.options.app)==null?void 0:o.metadataCache.getFileCache(n);return!s||!s.tags?!1:s.tags.some(a=>a.tag===e)}),this.allFiles=this.sortFilesByTimeField(this.allFiles,this.options.timeField)}filterFilesByRange(){return this.options.timeRange?(this.filteredFiles=[],this.options.timeRange==="all"?(this.filteredFiles=[...this.allFiles],this.filteredFiles):(this.options.mode==="daily"?this.filterDailyNotesByRange():this.filterFilesByTimeRange(),this.filteredFiles)):(this.filteredFiles=[...this.allFiles],this.filteredFiles)}filterFilesByTimeRange(){const t=f.moment(),{isReverse:e,baseTimeField:n}=this.parseTimeField(this.options.timeField);this.filteredFiles=this.allFiles.filter(s=>{const o=f.moment(s.stat[n]);return this.isDateInRange(o,t)}),e&&this.filteredFiles.reverse()}filterDailyNotesByRange(){const t=f.moment(),e=bt().format||Ft;this.filteredFiles=this.allFiles.filter(n=>{const s=f.moment(n.basename,e);return this.isDateInRange(s,t)})}isDateInRange(t,e){switch(this.options.timeRange){case"week":return t.isSame(e,"week");case"month":return t.isSame(e,"month");case"year":return t.isSame(e,"year");case"last-week":return t.isBetween(f.moment().subtract(1,"week").startOf("week"),f.moment().subtract(1,"week").endOf("week"),null,"[]");case"last-month":return t.isBetween(f.moment().subtract(1,"month").startOf("month"),f.moment().subtract(1,"month").endOf("month"),null,"[]");case"last-year":return t.isBetween(f.moment().subtract(1,"year").startOf("year"),f.moment().subtract(1,"year").endOf("year"),null,"[]");case"quarter":return t.isSame(e,"quarter");case"last-quarter":return t.isBetween(f.moment().subtract(1,"quarter").startOf("quarter"),f.moment().subtract(1,"quarter").endOf("quarter"),null,"[]");case"custom":if(this.options.customRange){const n=f.moment(this.options.customRange.start),s=f.moment(this.options.customRange.end);return t.isBetween(n,s,null,"[]")}return!1;default:return!0}}checkDailyNote(){if(this.options.mode!=="daily")return this.hasCurrentDay=!0,!0;const t=f.moment();return ue(t,this.cacheDailyNotes)?(this.hasCurrentDay=!0,!0):(this.hasCurrentDay=!1,!1)}async createNewDailyNote(){if(this.options.mode!=="daily"||this.hasCurrentDay)return null;const t=f.moment(),e=await de(t);return e?(this.allFiles.push(e),this.allFiles=this.sortDailyNotes(this.allFiles),this.hasCurrentDay=!0,this.filterFilesByRange(),e):null}fileCreate(t){this.options.mode==="daily"?this.handleDailyNoteCreate(t):this.options.mode==="folder"?this.handleFolderFileCreate(t):this.options.mode==="tag"&&this.handleTaggedFileCreate(t)}handleDailyNoteCreate(t){const e=Rt(t,"day"),n=bt().format||Ft;if(!e)return;if(this.filteredFiles.length===0){this.allFiles.push(t),this.allFiles=this.sortDailyNotes(this.allFiles),this.filterFilesByRange();return}const s=this.filteredFiles[this.filteredFiles.length-1],o=this.filteredFiles[0],a=f.moment(s.basename,n),r=f.moment(o.basename,n);e.isBetween(a,r)?(this.filteredFiles.push(t),this.filteredFiles=this.sortDailyNotes(this.filteredFiles)):e.isBefore(a)?(this.allFiles.push(t),this.allFiles=this.sortDailyNotes(this.allFiles),this.filterFilesByRange()):e.isAfter(r)&&(this.filteredFiles.push(t),this.filteredFiles=this.sortDailyNotes(this.filteredFiles)),e.isSame(f.moment(),"day")&&(this.hasCurrentDay=!0)}handleFolderFileCreate(t){var n;if(!this.options.target)return;const e=((n=t.parent)==null?void 0:n.path)||"";(e===this.options.target||e.startsWith(this.options.target+"/"))&&(this.allFiles.push(t),this.allFiles=this.sortFilesByTimeField(this.allFiles,this.options.timeField),this.filterFilesByRange())}handleTaggedFileCreate(t){if(!this.options.target||!this.options.app)return;const e=this.options.target.startsWith("#")?this.options.target:"#"+this.options.target,n=this.options.app.metadataCache.getFileCache(t);!n||!n.tags||n.tags.some(s=>s.tag===e)&&(this.allFiles.push(t),this.allFiles=this.sortFilesByTimeField(this.allFiles,this.options.timeField),this.filterFilesByRange())}fileDelete(t){this.options.mode==="daily"&&Rt(t,"day")?(this.filteredFiles=this.filteredFiles.filter(e=>e.basename!==t.basename),this.allFiles=this.allFiles.filter(e=>e.basename!==t.basename),this.filterFilesByRange(),this.checkDailyNote()):(this.filteredFiles=this.filteredFiles.filter(e=>e.basename!==t.basename),this.allFiles=this.allFiles.filter(e=>e.basename!==t.basename))}sortDailyNotes(t){const e=bt().format||Ft;return t.sort((n,s)=>f.moment(s.basename,e).valueOf()-f.moment(n.basename,e).valueOf())}getAllFiles(){return this.allFiles}getFilteredFiles(){return this.filteredFiles}hasCurrentDayNote(){return this.hasCurrentDay}updateOptions(t){this.options={...this.options,...t},(t.timeRange||t.customRange)&&this.filterFilesByRange(),(t.mode||t.target)&&(this.allFiles=[],this.filteredFiles=[],this.hasFetched=!1,this.fetchFiles())}}function Vt(i,t,e){const n=i.slice();return n[29]=t[e],n}function jt(i){let t;return{c(){t=P("div"),t.innerHTML='<div class="dn-stock-text svelte-4q3cv7">No files found</div>',k(t,"class","dn-stock svelte-4q3cv7")},m(e,n){B(e,t,n)},d(e){e&&A(t)}}}function Ut(i){let t,e,n;return{c(){t=P("div"),t.innerHTML='<div class="dn-blank-day-text svelte-4q3cv7">Create a daily note for today ✍</div>',k(t,"class","dn-blank-day svelte-4q3cv7"),k(t,"aria-hidden","true")},m(s,o){B(s,t,o),e||(n=H(t,"click",i[12]),e=!0)},p:V,d(s){s&&A(t),e=!1,n()}}}function zt(i,t){let e,n,s,o,a,r;n=new Pi({props:{file:t[29],plugin:t[0],leaf:t[1],shouldRender:t[4].has(t[29].path)}});function d(...l){return t[22](t[29],...l)}return{key:i,first:null,c(){e=P("div"),Ti(n.$$.fragment),k(e,"class","daily-note-wrapper svelte-4q3cv7"),this.first=e},m(l,h){B(l,e,h),ke(n,e,null),o=!0,a||(r=[ge(s=Ce.call(null,e,{rootMargin:"80%",unobserveOnEnter:!1,root:t[1].view.contentEl})),H(e,"inview_change",d)],a=!0)},p(l,h){t=l;const c={};h[0]&64&&(c.file=t[29]),h[0]&1&&(c.plugin=t[0]),h[0]&2&&(c.leaf=t[1]),h[0]&80&&(c.shouldRender=t[4].has(t[29].path)),n.$set(c),s&&ht(s.update)&&h[0]&2&&s.update.call(null,{rootMargin:"80%",unobserveOnEnter:!1,root:t[1].view.contentEl})},i(l){o||(vt(n.$$.fragment,l),o=!0)},o(l){Lt(n.$$.fragment,l),o=!1},d(l){l&&A(e),Fe(n),a=!1,O(r)}}}function Qt(i){let t;return{c(){t=P("div"),t.textContent="—— No more of results ——",k(t,"class","no-more-text svelte-4q3cv7")},m(e,n){B(e,t,n)},d(e){e&&A(t)}}}function Vi(i){var $;let t,e,n=i[3]==="daily"&&!(($=i[5])!=null&&$.hasCurrentDayNote())&&(i[2]==="all"||i[2]==="week"||i[2]==="month"||i[2]==="year"||i[2]==="quarter"),s,o=[],a=new Map,r,d,l,h,c,u,g,p=i[6].length===0&&jt(),w=n&&Ut(i),y=Bt(i[6]);const F=b=>b[29].path;for(let b=0;b<y.length;b+=1){let C=Vt(i,y,b),T=F(C);a.set(T,o[b]=zt(T,C))}let m=!i[7]&&Qt();return{c(){t=P("div"),p&&p.c(),e=W(),w&&w.c(),s=W();for(let b=0;b<o.length;b+=1)o[b].c();r=W(),d=P("div"),h=W(),m&&m.c(),k(d,"class","dn-view-loader"),k(t,"class","daily-note-view")},m(b,C){B(b,t,C),p&&p.m(t,null),R(t,e),w&&w.m(t,null),R(t,s);for(let T=0;T<o.length;T+=1)o[T]&&o[T].m(t,null);R(t,r),R(t,d),i[23](d),R(t,h),m&&m.m(t,null),c=!0,u||(g=[ge(l=Ce.call(null,d,{root:i[1].view.containerEl})),H(d,"inview_init",i[9]),H(d,"inview_change",i[11]),H(d,"inview_leave",i[10])],u=!0)},p(b,C){var T;b[6].length===0?p||(p=jt(),p.c(),p.m(t,e)):p&&(p.d(1),p=null),C[0]&44&&(n=b[3]==="daily"&&!((T=b[5])!=null&&T.hasCurrentDayNote())&&(b[2]==="all"||b[2]==="week"||b[2]==="month"||b[2]==="year"||b[2]==="quarter")),n?w?w.p(b,C):(w=Ut(b),w.c(),w.m(t,s)):w&&(w.d(1),w=null),C[0]&8275&&(y=Bt(b[6]),Si(),o=Mi(o,C,F,1,b,y,a,t,Di,zt,r,Vt),Ci()),l&&ht(l.update)&&C[0]&2&&l.update.call(null,{root:b[1].view.containerEl}),b[7]?m&&(m.d(1),m=null):m||(m=Qt(),m.c(),m.m(t,null))},i(b){if(!c){for(let C=0;C<y.length;C+=1)vt(o[C]);c=!0}},o(b){for(let C=0;C<o.length;C+=1)Lt(o[C]);c=!1},d(b){b&&A(t),p&&p.d(),w&&w.d();for(let C=0;C<o.length;C+=1)o[C].d();i[23](null),m&&m.d(),u=!1,O(g)}}}const ji=1;function Ui(i,t,e){let n,{plugin:s}=t,{leaf:o}=t,{selectedRange:a="all"}=t,{customRange:r=null}=t,{selectionMode:d="daily"}=t,{target:l=""}=t,{timeField:h="mtime"}=t,c,u=[],g=[],p=new Set,w=!0,y=!0,F,m;ye(()=>{e(5,m=new Yi(n)),e(21,g=m.getFilteredFiles()),e(7,w=g.length>0),b(),$()});function $(){if(!o||!o.view||!o.view.titleEl)return;const v=o.view.titleEl;v.empty();let L="";d==="daily"&&a!=="all"?a==="custom"&&r?L=`Showing notes from: ${f.moment(r.start).format("YYYY-MM-DD")} to ${f.moment(r.end).format("YYYY-MM-DD")}`:L=`Showing notes for: ${a}`:d==="folder"?(L=`Showing files from folder: ${l}`,a!=="all"&&(L+=` (${h==="ctime"?"created":"modified"} ${a})`)):d==="tag"&&(L=`Showing files with tag: ${l}`,a!=="all"&&(L+=` (${h==="ctime"?"created":"modified"} ${a})`)),L?v.setText(L):v.setText("Daily Notes")}function b(){c||(c=setInterval(T,1))}function C(){clearInterval(c),c=null}function T(){o.height!==0&&(!m||!w||(g.length===0?e(7,w=!1):(e(6,u=[...u,...g.splice(0,ji)]),y&&window.setTimeout(()=>{D(),y=!1},100))))}function D(){if(!F)return;const v=F.getBoundingClientRect(),L=window.innerHeight,X=o.view.contentEl.clientHeight||o.view.contentEl.innerHeight||L,$t=Math.max(L,X)+200;v.top<$t&&(T(),window.setTimeout(()=>{w&&F&&F.getBoundingClientRect().top<$t&&D()},50))}function E(){return $i(this,void 0,void 0,function*(){const v=yield m.createNewDailyNote();v&&(e(6,u=[v,...u]),p.add(v.path),e(4,p))})}function x(){e(6,u),e(5,m),e(2,a),e(14,r),e(3,d),e(15,l),e(16,h),e(4,p),e(21,g)}function N(){m.checkDailyNote()}function G(v){m.fileCreate(v),d==="daily"?m.getFilteredFiles().some(X=>X.basename===v.basename)&&!u.some(X=>X.basename===v.basename)&&(e(6,u=[v,...u]),p.add(v.path),e(4,p)):e(6,u=m.getFilteredFiles().slice(0,u.length))}function K(v){m.fileDelete(v),e(6,u=u.filter(L=>L.basename!==v.basename)),p.has(v.path)&&(p.delete(v.path),e(4,p))}function J(v,L){L?p.add(v.path):p.delete(v.path),e(4,p)}const De=(v,{detail:L})=>J(v,L.inView);function Me(v){nt[v?"unshift":"push"](()=>{F=v,e(8,F)})}return i.$$set=v=>{"plugin"in v&&e(0,s=v.plugin),"leaf"in v&&e(1,o=v.leaf),"selectedRange"in v&&e(2,a=v.selectedRange),"customRange"in v&&e(14,r=v.customRange),"selectionMode"in v&&e(3,d=v.selectionMode),"target"in v&&e(15,l=v.target),"timeField"in v&&e(16,h=v.timeField)},i.$$.update=()=>{i.$$.dirty[0]&114701&&(n={mode:d,target:l,timeRange:a,customRange:r,app:s.app,timeField:h}),i.$$.dirty[0]&2211900&&m&&(a!==m.options.timeRange||r!==m.options.customRange||d!==m.options.mode||l!==m.options.target||h!==m.options.timeField)&&(m.updateOptions({timeRange:a,customRange:r,mode:d,target:l,timeField:h}),e(6,u=[]),p.clear(),e(21,g=m.getFilteredFiles()),e(7,w=g.length>0),y=!0,b(),$())},[s,o,a,d,p,m,u,w,F,b,C,T,E,J,r,l,h,x,N,G,K,g,De,Me]}class zi extends Ee{constructor(t){super(),be(this,t,Ui,Vi,pe,{plugin:0,leaf:1,selectedRange:2,customRange:14,selectionMode:3,target:15,timeField:16,tick:17,check:18,fileCreate:19,fileDelete:20},null,[-1,-1])}get tick(){return this.$$.ctx[17]}get check(){return this.$$.ctx[18]}get fileCreate(){return this.$$.ctx[19]}get fileDelete(){return this.$$.ctx[20]}}const q="daily-note-editor-view";class Zt extends f.ItemView{constructor(t,e){super(t),this.selectedDaysRange="all",this.selectionMode="daily",this.target="",this.timeField="mtime",this.customRange=null,this.getMode=()=>"source",this.onFileCreate=n=>{n instanceof f.TFile&&this.view.fileCreate(n)},this.onFileDelete=n=>{n instanceof f.TFile&&this.view.fileDelete(n)},this.plugin=e,this.scope=new f.Scope(e.app.scope)}getViewType(){return q}getDisplayText(){return this.selectionMode==="daily"?"Daily Notes":this.selectionMode==="folder"?`Folder: ${this.target}`:this.selectionMode==="tag"?`Tag: ${this.target}`:"Notes"}getIcon(){return this.selectionMode==="daily"?"calendar":this.selectionMode==="folder"?"folder":this.selectionMode==="tag"?"tag":"document"}setSelectedRange(t){this.selectedDaysRange=t,this.view&&(t==="custom"?this.view.$set({selectedRange:t,customRange:this.customRange}):this.view.$set({selectedRange:t}))}setSelectionMode(t,e=""){this.selectionMode=t,this.target=e,this.view&&this.view.$set({selectionMode:t,target:e})}saveCurrentSelectionAsPreset(){this.selectionMode!=="daily"&&this.target&&this.plugin.settings.preset.findIndex(e=>e.type===this.selectionMode&&e.target===this.target)===-1&&(this.plugin.settings.preset.push({type:this.selectionMode,target:this.target}),this.plugin.saveSettings())}getState(){return{...super.getState(),selectionMode:this.selectionMode,target:this.target,timeField:this.timeField,selectedRange:this.selectedDaysRange,customRange:this.customRange}}async setState(t,e){if(await super.setState(t,e),t&&typeof t=="object"&&!this.view){const n=t;n.selectionMode&&(this.selectionMode=n.selectionMode),n.target&&(this.target=n.target),n.timeField&&(this.timeField=n.timeField),n.selectedRange&&(this.selectedDaysRange=n.selectedRange),n.customRange&&(this.customRange=n.customRange),this.view=new zi({target:this.contentEl,props:{plugin:this.plugin,leaf:this.leaf,selectedRange:this.selectedDaysRange,customRange:this.customRange,selectionMode:this.selectionMode,target:this.target,timeField:this.timeField}}),this.app.workspace.onLayoutReady(this.view.tick.bind(this)),this.registerInterval(window.setInterval(async()=>{this.view.check()},1e3*60*60))}}setTimeField(t){this.timeField=t,this.view&&this.view.$set({timeField:t})}openDailyNoteEditor(){this.plugin.openDailyNoteEditor()}async onOpen(){this.scope.register(["Mod"],"f",t=>{}),this.addAction("clock","Select time field",t=>{const e=new f.Menu,n=(s,o)=>{e.addItem(a=>{a.setTitle(s),a.setChecked(this.timeField===o),a.setDisabled(this.selectionMode==="daily"),a.onClick(()=>{this.setTimeField(o)})})};n("Creation Time","ctime"),n("Modification Time","mtime"),n("Creation Time (Reverse)","ctimeReverse"),n("Modification Time (Reverse)","mtimeReverse"),e.showAtMouseEvent(t)}),this.addAction("layers-2","Select view mode",t=>{const e=new f.Menu,n=(s,o)=>{e.addItem(a=>{a.setTitle(s),a.setChecked(this.selectionMode===o&&!this.target),a.onClick(()=>{o==="daily"?this.setSelectionMode(o):new Zi(this.plugin.app,o,d=>{this.setSelectionMode(o,d),this.saveCurrentSelectionAsPreset()}).open()})})};if(n("Daily Notes","daily"),n("Folder","folder"),n("Tag","tag"),this.plugin.settings.preset.length>0){e.addSeparator(),e.addItem(s=>{s.setTitle("Saved Presets"),s.setDisabled(!0)});for(const s of this.plugin.settings.preset){const o=s.type==="folder"?`Folder: ${s.target}`:`Tag: ${s.target}`;e.addItem(a=>{a.setTitle(o),a.setChecked(this.selectionMode===s.type&&this.target===s.target),a.onClick(()=>{this.setSelectionMode(s.type,s.target)})})}}e.showAtMouseEvent(t)}),this.addAction("calendar-range","Select date range",t=>{const e=new f.Menu,n=(s,o)=>{e.addItem(a=>{a.setTitle(s),a.setChecked(this.selectedDaysRange===o),a.onClick(()=>{this.setSelectedRange(o)})})};n("All Notes","all"),n("This Week","week"),n("This Month","month"),n("This Year","year"),n("Last Week","last-week"),n("Last Month","last-month"),n("Last Year","last-year"),n("This Quarter","quarter"),n("Last Quarter","last-quarter"),e.addSeparator(),e.addItem(s=>{s.setTitle("Custom Date Range"),s.setChecked(this.selectedDaysRange==="custom"),s.onClick(()=>{new Qi(this.app,a=>{this.customRange=a,this.setSelectedRange("custom")}).open()})}),e.showAtMouseEvent(t)}),this.app.vault.on("create",this.onFileCreate),this.app.vault.on("delete",this.onFileDelete)}onPaneMenu(t,e){(e==="tab-header"||e==="more-options")&&t.addItem(n=>{n.setIcon(this.leaf.pinned?"pin-off":"pin"),n.setTitle(this.leaf.pinned?"Unpin":"Pin"),n.onClick(()=>{this.leaf.togglePinned()})})}}class Qi extends f.Modal{constructor(t,e){super(t),this.saveCallback=e,this.startDate=new Date,this.endDate=new Date}onOpen(){const{contentEl:t}=this;t.createEl("h2",{text:"Select Custom Date Range"});const e=t.createEl("div",{cls:"custom-range-date-container"});e.createEl("span",{text:"Start Date: "}),e.createEl("input",{type:"date",value:this.formatDate(this.startDate)}).addEventListener("change",r=>{this.startDate=new Date(r.target.value)});const s=t.createEl("div",{cls:"custom-range-date-container"});s.createEl("span",{text:"End Date: "}),s.createEl("input",{type:"date",value:this.formatDate(this.endDate)}).addEventListener("change",r=>{this.endDate=new Date(r.target.value)});const a=t.createEl("div",{cls:"custom-range-button-container"});new f.ButtonComponent(a).setButtonText("Cancel").onClick(()=>{this.close()}),new f.ButtonComponent(a).setButtonText("Confirm").setCta().onClick(()=>{this.saveCallback({start:this.startDate,end:this.endDate}),this.close()})}formatDate(t){const e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0");return`${e}-${n}-${s}`}onClose(){this.contentEl.empty()}}class Zi extends f.Modal{constructor(t,e,n){super(t),this.mode=e,this.saveCallback=n}onOpen(){const{contentEl:t}=this;t.empty(),t.createEl("h2",{text:this.mode==="folder"?"Select Folder":"Select Tag"});const e=t.createEl("form");e.addEventListener("submit",r=>{r.preventDefault(),this.save()});const n=e.createDiv();n.addClass("setting-item");const s=n.createDiv();s.addClass("setting-item-info"),s.createEl("div",{text:this.mode==="folder"?"Folder Path":"Tag Name",cls:"setting-item-name"}),s.createEl("div",{text:this.mode==="folder"?"Enter the path to the folder (e.g., 'folder/subfolder')":"Enter the tag name without the '#' (e.g., 'tag')",cls:"setting-item-description"});const o=n.createDiv();o.addClass("setting-item-control"),this.targetInput=o.createEl("input",{type:"text",value:""}),this.targetInput.addClass("target-input");const a=t.createDiv();a.addClass("modal-button-container"),a.createEl("button",{text:"Cancel",cls:"mod-warning",attr:{type:"button"}}).addEventListener("click",()=>{this.close()}),a.createEl("button",{text:"Save",cls:"mod-cta",attr:{type:"submit"}}).addEventListener("click",r=>{r.preventDefault(),this.save()})}save(){const t=this.targetInput.value.trim();t&&(this.saveCallback(t),this.close())}onClose(){const{contentEl:t}=this;t.empty()}}class Gi extends f.Plugin{async onload(){this.addSettingTab(new Oe(this.app,this)),await this.loadSettings(),this.patchWorkspace(),this.patchWorkspaceLeaf(),_e(),this.registerEditorExtension([gi({app:this.app,plugin:this})]),this.registerView(q,t=>this.view=new Zt(t,this)),this.addRibbonIcon("calendar-range","Open Daily Note Editor",t=>this.openDailyNoteEditor()),this.addCommand({id:"open-daily-note-editor",name:"Open Daily Note Editor",callback:()=>this.openDailyNoteEditor()}),this.initCssRules(),this.settings.createAndOpenOnStartup&&this.app.workspace.onLayoutReady(async()=>{await this.ensureTodaysDailyNoteExists(),!(this.app.workspace.getLeavesOfType(q).length>0)&&await this.openDailyNoteEditor()}),this.app.workspace.on("file-menu",(t,e,n,s)=>{e instanceof f.TFolder&&t.addItem(o=>{o.setIcon("calendar-range"),o.setTitle("Open daily notes for this folder"),o.onClick(()=>{this.openFolderView(e.path)})})})}onunload(){this.app.workspace.detachLeavesOfType(q),document.body.toggleClass("daily-notes-hide-frontmatter",!1),document.body.toggleClass("daily-notes-hide-backlinks",!1)}async openDailyNoteEditor(){const t=this.app.workspace,e=t.getLeaf(!0);await e.setViewState({type:q}),t.revealLeaf(e)}async openFolderView(t,e="mtime"){const n=this.app.workspace,s=n.getLeaf(!0);await s.setViewState({type:q});const o=s.view;o.setSelectionMode("folder",t),o.setTimeField(e),n.revealLeaf(s)}async openTagView(t,e="mtime"){const n=this.app.workspace,s=n.getLeaf(!0);await s.setViewState({type:q});const o=s.view;o.setSelectionMode("tag",t),o.setTimeField(e),n.revealLeaf(s)}async ensureTodaysDailyNoteExists(){try{const t=f.moment(),e=he();ue(t,e)||await de(t)}catch(t){console.error("Failed to create daily note:",t)}}initCssRules(){document.body.toggleClass("daily-notes-hide-frontmatter",this.settings.hideFrontmatter),document.body.toggleClass("daily-notes-hide-backlinks",this.settings.hideBacklinks)}patchWorkspace(){let t=!1;const e=ut(f.Workspace.prototype,{getActiveViewOfType:n=>function(s){const o=n.call(this,s);if(!o&&(s==null?void 0:s.VIEW_TYPE)==="markdown"){const a=this.activeLeaf;return(a==null?void 0:a.view)instanceof Zt?a.view.editMode:o}return o},changeLayout(n){return async function(s){t=!0;try{await n.call(this,s)}finally{t=!1}}},iterateLeaves(n){return function(s,o){if(n.call(this,s,o))return!0;const a=typeof s=="function"?s:o,r=typeof s=="function"?o:s;if(!r||t)return!1;if(!f.requireApiVersion("0.15.0")&&(r===this.app.workspace.rootSplit||f.WorkspaceContainer&&r instanceof f.WorkspaceContainer)){for(const d of et.popoversForWindow(r.win))if(n.call(this,a,d.rootSplit))return!0}return!1}},setActiveLeaf:n=>function(s,o){if(s.parentLeaf){s.parentLeaf.activeTime=17e11,n.call(this,s.parentLeaf,o),s.view.editMode&&(this.activeEditor=s.view,s.parentLeaf.view.editMode=s.view);return}return n.call(this,s,o)}});this.register(e)}patchWorkspaceLeaf(){this.register(ut(f.WorkspaceLeaf.prototype,{getRoot(t){return function(){const e=t.call(this);return(e==null?void 0:e.getRoot)===this.getRoot?e:e==null?void 0:e.getRoot()}},setPinned(t){return function(e){t.call(this,e),yt(this)&&!e&&this.setPinned(!0)}},openFile(t){return function(e,n){if(yt(this)){setTimeout(ut(f.Workspace.prototype,{recordMostRecentOpenedFile(o){return function(a){if(a!==e)return o.call(this,a)}}}),1);const s=this.app.plugins.plugins["recent-files-obsidian"];s&&setTimeout(ut(s,{shouldAddFile(o){return function(a){return a!==e&&o.call(this,a)}}}),1)}return t.call(this,e,n)}}}))}async loadSettings(){this.settings=Object.assign({},Ae,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}}module.exports=Gi;

/* nosourcemap */